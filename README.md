# Enhanced RAG System with Sentence Transformers

[![Python](https://img.shields.io/badge/Python-3.8+-blue.svg)](https://python.org)
[![Streamlit](https://img.shields.io/badge/Streamlit-1.28+-red.svg)](https://streamlit.io)
[![LangChain](https://img.shields.io/badge/LangChain-0.1+-green.svg)](https://langchain.com)
[![License](https://img.shields.io/badge/License-MIT-yellow.svg)](LICENSE)

M·ªôt h·ªá th·ªëng RAG (Retrieval-Augmented Generation) ti√™n ti·∫øn s·ª≠ d·ª•ng Sentence Transformers cho embedding v√† API LLM cho vi·ªác sinh text. H·ªó tr·ª£ ƒëa d·∫°ng lo·∫°i file v√† cung c·∫•p giao di·ªán web tr·ª±c quan.

## üöÄ T√≠nh nƒÉng ch√≠nh

- **ƒêa d·∫°ng lo·∫°i file**: PDF, DOCX, TXT, MD, PY, HTML, CSS, JS
- **Embedding ti√™n ti·∫øn**: S·ª≠ d·ª•ng Sentence Transformers cho vector embeddings ch·∫•t l∆∞·ª£ng cao
- **API LLM linh ho·∫°t**: H·ªó tr·ª£ Groq, Google Gemini, OpenRouter
- **Giao di·ªán th√¢n thi·ªán**: Web UI v·ªõi Streamlit
- **Qu·∫£n l√Ω l·ªãch s·ª≠**: L∆∞u v√† kh√¥i ph·ª•c c√°c phi√™n chat
- **T√¨m ki·∫øm th√¥ng minh**: Vector search v·ªõi ƒëi·ªÅu ch·ªânh threshold
- **Theo d√µi ngu·ªìn**: Hi·ªÉn th·ªã ngu·ªìn th√¥ng tin cho m·ªói c√¢u tr·∫£ l·ªùi

## üèóÔ∏è Ki·∫øn tr√∫c h·ªá th·ªëng

### T·ªïng quan ki·∫øn tr√∫c

```mermaid
graph TB
    A[User Interface - Streamlit] --> B[Document Loader]
    A --> C[RAG Engine]
    B --> D[Multiple File Types]
    B --> E[Text Splitter]
    E --> F[Sentence Transformers]
    F --> G[Vector Store - ChromaDB]
    C --> G
    C --> H[LLM API Provider]
    C --> I[Chat Memory Manager]
    C --> J[Response Generator]
    
    subgraph "File Types"
        D1[PDF] --> D
        D2[DOCX] --> D
        D3[TXT/MD] --> D
        D4[Code Files] --> D
        D5[HTML] --> D
    end
    
    subgraph "LLM Providers"
        H1[Groq] --> H
        H2[Google Gemini] --> H
        H3[OpenRouter] --> H
    end
```

### Lu·ªìng x·ª≠ l√Ω d·ªØ li·ªáu

```mermaid
sequenceDiagram
    participant U as User
    participant UI as Streamlit UI
    participant DL as Document Loader
    participant TS as Text Splitter
    participant ST as Sentence Transformers
    participant VS as Vector Store
    participant RAG as RAG Engine
    participant LLM as LLM API
    
    U->>UI: Upload Documents
    UI->>DL: Process Files
    DL->>TS: Split into Chunks
    TS->>ST: Generate Embeddings
    ST->>VS: Store Vectors
    
    U->>UI: Ask Question
    UI->>RAG: Process Query
    RAG->>VS: Similarity Search
    VS->>RAG: Return Relevant Chunks
    RAG->>LLM: Generate Response
    LLM->>RAG: Return Answer
    RAG->>UI: Display Response
    UI->>U: Show Answer + Sources
```

## üîß C√¥ng ngh·ªá s·ª≠ d·ª•ng

### Core Technologies

| C√¥ng ngh·ªá | Phi√™n b·∫£n | M·ª•c ƒë√≠ch |
|-----------|-----------|----------|
| **Python** | 3.8+ | Ng√¥n ng·ªØ l·∫≠p tr√¨nh ch√≠nh |
| **Streamlit** | 1.28+ | Giao di·ªán web v√† UI components |
| **LangChain** | 0.1+ | Framework cho LLM applications |
| **Sentence Transformers** | Latest | T·∫°o embeddings ch·∫•t l∆∞·ª£ng cao |
| **ChromaDB** | Latest | Vector database cho similarity search |

### Document Processing

| Library | M·ª•c ƒë√≠ch |
|---------|----------|
| **PyPDF** | X·ª≠ l√Ω file PDF |
| **python-docx** | ƒê·ªçc file Word documents |
| **Unstructured** | X·ª≠ l√Ω HTML, Markdown |
| **TextLoader** | X·ª≠ l√Ω code files v√† plain text |

### LLM API Providers

| Provider | Models | API Key Required |
|----------|--------|------------------|
| **Groq** | Llama, Mixtral, Gemma | `GROQ_API_KEY` |
| **Google** | Gemini Pro, Gemini Flash | `GOOGLE_API_KEY` |
| **OpenRouter** | Multiple models | `OPENROUTER_API_KEY` |

## üì¶ C√†i ƒë·∫∑t

### Prerequisites

- Python 3.8 ho·∫∑c cao h∆°n
- Git
- API key t·ª´ m·ªôt trong c√°c providers (Groq, Google, OpenRouter)

### B∆∞·ªõc 1: Clone repository

```bash
git clone https://github.com/your-username/enhanced-rag-system.git
cd enhanced-rag-system
```

### B∆∞·ªõc 2: T·∫°o virtual environment

```bash
# Windows
python -m venv venv
venv\Scripts\activate

# Linux/Mac
python3 -m venv venv
source venv/bin/activate
```

### B∆∞·ªõc 3: C√†i ƒë·∫∑t dependencies

```bash
pip install -r requirements.txt
```

### B∆∞·ªõc 4: C·∫•u h√¨nh environment variables

T·∫°o file `.env` trong th∆∞ m·ª•c g·ªëc:

```env
# Ch·ªçn m·ªôt LLM provider
LLM_PROVIDER=groq
MODEL_NAME=llama3-70b-8192

# API Keys (ch·ªçn provider t∆∞∆°ng ·ª©ng)
GROQ_API_KEY=your_groq_api_key_here
GOOGLE_API_KEY=your_google_api_key_here
OPENROUTER_API_KEY=your_openrouter_api_key_here
```

### B∆∞·ªõc 5: T·∫°o file c·∫•u h√¨nh

**config.json:**
```json
{
  "embedding_model": "all-MiniLM-L6-v2",
  "chunk_size": 1024,
  "chunk_overlap": 100,
  "pipeline": "sentence_transformer_api"
}
```

**prompt.json:**
```json
{
  "prompt_template": "You are a helpful AI assistant with expertise in analyzing documents. Use the following context to answer the user's question accurately and comprehensively.\n\nContext from documents:\n{context}\n\nPrevious conversation:\n{chat_history}\n\nUser Question: {question}\n\nPlease provide a detailed and accurate answer based on the context provided. If the context doesn't contain enough information to answer the question completely, please state that clearly and suggest what additional information might be needed."
}
```

## üöÄ S·ª≠ d·ª•ng

### Kh·ªüi ch·∫°y ·ª©ng d·ª•ng

```bash
streamlit run app_main.py
```

Truy c·∫≠p `http://localhost:8501` ƒë·ªÉ s·ª≠ d·ª•ng ·ª©ng d·ª•ng.

### H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng

#### 1. Upload Documents
- S·ª≠ d·ª•ng sidebar ƒë·ªÉ upload c√°c file
- H·ªó tr·ª£: PDF, DOCX, TXT, MD, PY, HTML, CSS, JS
- C√≥ th·ªÉ upload nhi·ªÅu file c√πng l√∫c
- H·ªá th·ªëng s·∫Ω t·ª± ƒë·ªông ph√¢n t√≠ch v√† t·∫°o embeddings

#### 2. C·∫•u h√¨nh Parameters
- **Number of Retrieved Results (k)**: S·ªë l∆∞·ª£ng ƒëo·∫°n text li√™n quan ƒë∆∞·ª£c truy xu·∫•t (1-15)
- **Similarity Score Threshold**: Ng∆∞·ª°ng ƒë·ªô t∆∞∆°ng ƒë·ªìng (0.0-1.0)
  - Cao h∆°n = k·∫øt qu·∫£ ch√≠nh x√°c h∆°n nh∆∞ng √≠t h∆°n
  - Th·∫•p h∆°n = nhi·ªÅu k·∫øt qu·∫£ h∆°n nh∆∞ng c√≥ th·ªÉ k√©m li√™n quan

#### 3. Chat Interface
- Nh·∫≠p c√¢u h·ªèi trong √¥ text input
- H·ªá th·ªëng s·∫Ω:
  - T√¨m ki·∫øm th√¥ng tin li√™n quan trong documents
  - Sinh c√¢u tr·∫£ l·ªùi s·ª≠ d·ª•ng LLM API
  - Hi·ªÉn th·ªã ngu·ªìn th√¥ng tin
  - L∆∞u l·ªãch s·ª≠ conversation

#### 4. Qu·∫£n l√Ω Session
- **Save Session**: L∆∞u cu·ªôc tr√≤ chuy·ªán hi·ªán t·∫°i
- **Load Session**: Kh√¥i ph·ª•c cu·ªôc tr√≤ chuy·ªán ƒë√£ l∆∞u
- **Clear Chat**: X√≥a l·ªãch s·ª≠ chat hi·ªán t·∫°i

## üîç Chi ti·∫øt k·ªπ thu·∫≠t

### X·ª≠ l√Ω Documents

```python
# Document loading pipeline
Document Upload ‚Üí File Type Detection ‚Üí Appropriate Loader Selection ‚Üí 
Text Extraction ‚Üí Chunking ‚Üí Embedding Generation ‚Üí Vector Storage
```

### RAG Pipeline

```python
# Query processing pipeline
User Query ‚Üí Similarity Search ‚Üí Context Retrieval ‚Üí 
Prompt Construction ‚Üí LLM API Call ‚Üí Response Generation ‚Üí 
Source Attribution ‚Üí Memory Update
```

### Vector Search

- **Embedding Model**: Sentence Transformers (configurable)
- **Vector Store**: ChromaDB v·ªõi persistent storage
- **Search Type**: Cosine similarity
- **Filtering**: Score threshold v√† top-k results

### Memory Management

- **Conversation Buffer**: L∆∞u tr·ªØ l·ªãch s·ª≠ chat g·∫ßn ƒë√¢y
- **Session Persistence**: JSON-based storage
- **Context Window**: Configurable window size cho conversation context

## üìÅ C·∫•u tr√∫c project

```
enhanced-rag-system/
‚îú‚îÄ‚îÄ app_main.py                          # Main Streamlit application
‚îú‚îÄ‚îÄ rag_sentence_transformer_api.py     # Enhanced RAG engine
‚îú‚îÄ‚îÄ document_loader.py                  # Multi-format document processing
‚îú‚îÄ‚îÄ chat_memory.py                      # Conversation memory management
‚îú‚îÄ‚îÄ chat_history.py                     # Session persistence
‚îú‚îÄ‚îÄ document_summarizer.py              # Document summarization
‚îú‚îÄ‚îÄ llm_providers.py                    # LLM API integrations
‚îú‚îÄ‚îÄ requirements.txt                    # Python dependencies
‚îú‚îÄ‚îÄ config.json                         # System configuration
‚îú‚îÄ‚îÄ prompt.json                         # Prompt templates
‚îú‚îÄ‚îÄ .env                               # Environment variables
‚îú‚îÄ‚îÄ README.md                          # This file
‚îî‚îÄ‚îÄ chat_history/                      # Stored chat sessions
    ‚îú‚îÄ‚îÄ session_20241201_143022.json
    ‚îî‚îÄ‚îÄ ...
```

## ‚öôÔ∏è C·∫•u h√¨nh n√¢ng cao

### Custom Embedding Models

S·ª≠a `config.json` ƒë·ªÉ s·ª≠ d·ª•ng embedding model kh√°c:

```json
{
  "embedding_model": "sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2",
  "chunk_size": 1024,
  "chunk_overlap": 100
}
```

### T√πy ch·ªânh Prompts

Ch·ªânh s·ª≠a `prompt.json` ƒë·ªÉ t√πy ch·ªânh c√°ch LLM ph·∫£n h·ªìi:

```json
{
  "prompt_template": "Your custom prompt template here with {context}, {chat_history}, and {question} placeholders"
}
```

### LLM Provider Configuration

C·∫•u h√¨nh chi ti·∫øt trong `.env`:

```env
# Groq Configuration
LLM_PROVIDER=groq
MODEL_NAME=mixtral-8x7b-32768
GROQ_API_KEY=your_key

# Google Configuration  
LLM_PROVIDER=google
MODEL_NAME=gemini-pro
GOOGLE_API_KEY=your_key

# OpenRouter Configuration
LLM_PROVIDER=openrouter
MODEL_NAME=openai/gpt-4-turbo
OPENROUTER_API_KEY=your_key
```

## üêõ Troubleshooting

### L·ªói th∆∞·ªùng g·∫∑p

1. **ModuleNotFoundError**: 
   ```bash
   pip install -r requirements.txt
   ```

2. **API Key errors**:
   - Ki·ªÉm tra file `.env` v√† API keys
   - ƒê·∫£m b·∫£o provider ƒë∆∞·ª£c c·∫•u h√¨nh ƒë√∫ng

3. **Memory issues v·ªõi large documents**:
   - Gi·∫£m `chunk_size` trong config.json
   - TƒÉng `score_threshold` ƒë·ªÉ filter k·∫øt qu·∫£

4. **ChromaDB persistence errors**:
   ```bash
   # X√≥a database c≈©
   rm -rf chroma_db_sentence_transformer_api
   ```

### Performance Optimization

- **TƒÉng chunk_size**: X·ª≠ l√Ω nhanh h∆°n nh∆∞ng √≠t precise
- **Gi·∫£m retrieval_k**: √çt context nh∆∞ng response nhanh h∆°n
- **S·ª≠ d·ª•ng embedding model nh·ªè h∆°n**: Trade-off gi·ªØa quality v√† speed

## ü§ù Contributing

1. Fork repository
2. T·∫°o feature branch (`git checkout -b feature/AmazingFeature`)
3. Commit changes (`git commit -m 'Add some AmazingFeature'`)
4. Push to branch (`git push origin feature/AmazingFeature`)
5. M·ªü Pull Request

## üìÑ License

Distributed under the MIT License. See `LICENSE` for more information.

## üìû Support

- üêõ **Bug Reports**: [GitHub Issues](https://github.com/ngoquytuan/enhanced-rag-system/issues)
- üí¨ **Discussions**: [GitHub Discussions](https://github.com/ngoquytuan/enhanced-rag-system/discussions)
- üìß **Email**: ngoquytuan@gmail.com

## üôè Acknowledgments

- [LangChain](https://langchain.com) - Framework for LLM applications
- [Streamlit](https://streamlit.io) - Web application framework
- [Sentence Transformers](https://www.sbert.net) - Embedding models
- [ChromaDB](https://www.trychroma.com) - Vector database
- [Hugging Face](https://huggingface.co) - ML model hub

---

‚≠ê **Star repository n·∫øu project h·ªØu √≠ch cho b·∫°n!**
